# Story 39.1: Training Service Foundation

**Epic:** 39 - AI Automation Service Modularization & Performance Optimization  
**Story:** 39.1  
**Status:** ðŸš§ In Progress  
**Priority:** P0  
**Story Points:** 5  
**Effort:** 4-6 hours  
**Developer:** BMAD Master

---

## User Story

**As a** system administrator  
**I want** a dedicated training service for AI model training and synthetic data generation  
**So that** training operations can scale independently and don't impact the main query service performance

---

## Acceptance Criteria

- [x] New service created at `services/ai-training-service/`
- [ ] Training endpoints extracted from main service
- [ ] Docker service configured (Port 8022)
- [ ] Database connection pooling configured
- [ ] Health endpoint operational
- [ ] All training tests passing

---

## Tasks

### Task 1: Create Service Structure
- [x] Create `services/ai-training-service/` directory
- [x] Create `src/main.py` with FastAPI app
- [x] Create `src/config.py` with settings
- [x] Create `src/database/__init__.py` with connection pooling
- [x] Create `src/api/health_router.py`
- [ ] Create `src/api/training_router.py` (extract from admin_router)

### Task 2: Extract Training Endpoints
- [ ] Extract training CRUD functions
- [ ] Extract TrainingRun model
- [ ] Create training router with endpoints:
  - GET `/api/v1/training/runs` - List training runs
  - POST `/api/v1/training/trigger` - Trigger soft prompt training
  - POST `/api/v1/training/gnn/trigger` - Trigger GNN training
  - GET `/api/v1/training/gnn/runs` - List GNN training runs
  - GET `/api/v1/training/gnn/status` - Get GNN training status
  - DELETE `/api/v1/training/runs/{run_id}` - Delete training run
  - DELETE `/api/v1/training/runs` - Clear old training runs

### Task 3: Docker Configuration
- [ ] Create Dockerfile
- [ ] Create requirements.txt
- [ ] Update docker-compose.yml with training service
- [ ] Configure service networking

### Task 4: Database Setup
- [x] Configure connection pooling (max 10 connections)
- [ ] Import TrainingRun model
- [ ] Import training CRUD functions
- [ ] Test database connectivity

### Task 5: Testing
- [ ] Create unit tests for training router
- [ ] Create integration tests
- [ ] Verify health endpoint
- [ ] Test database connection pooling

---

## Dev Notes

### Service Structure

```
services/ai-training-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py                    # FastAPI app
â”‚   â”œâ”€â”€ config.py                  # Settings
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ __init__.py           # Connection pooling
â”‚   â”‚   â””â”€â”€ models.py             # TrainingRun model
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ health_router.py      # Health checks
â”‚   â”‚   â””â”€â”€ training_router.py    # Training endpoints
â”‚   â””â”€â”€ crud/
â”‚       â””â”€â”€ training.py            # Training CRUD functions
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

### Port Configuration
- **Training Service:** Port 8022
- **Internal:** `http://ai-training-service:8022`
- **External:** `http://localhost:8022` (if exposed)

### Database Connection Pooling
- **Pool Size:** 10 connections (max 20 per service)
- **Max Overflow:** 5 connections
- **Shared Database:** SQLite at `/app/data/ai_automation.db`

### Endpoints to Extract

From `admin_router.py`:
- `/api/v1/admin/training/runs` â†’ `/api/v1/training/runs`
- `/api/v1/admin/training/trigger` â†’ `/api/v1/training/trigger`
- `/api/v1/admin/training/gnn/trigger` â†’ `/api/v1/training/gnn/trigger`
- `/api/v1/admin/training/gnn/runs` â†’ `/api/v1/training/gnn/runs`
- `/api/v1/admin/training/gnn/status` â†’ `/api/v1/training/gnn/status`
- `/api/v1/admin/training/runs/{run_id}` â†’ `/api/v1/training/runs/{run_id}`
- `/api/v1/admin/training/runs` (DELETE) â†’ `/api/v1/training/runs` (DELETE)

---

## Dependencies

- Shared database (SQLite)
- Training scripts (soft prompt, GNN)
- Model storage directory

---

## Related Files

- `services/ai-automation-service/src/api/admin_router.py` - Source of training endpoints
- `services/ai-automation-service/src/database/models.py` - TrainingRun model
- `services/ai-automation-service/src/database/crud.py` - Training CRUD functions

---

**Created:** November 25, 2025  
**Last Updated:** November 25, 2025  
**Status:** ðŸš§ In Progress


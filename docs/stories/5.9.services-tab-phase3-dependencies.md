# Story 5.9: Services Tab - Phase 3: Service Dependencies Visualization

## Status
Ready for Review

## Story

**As a** system administrator,  
**I want** to visualize service dependencies and data flow,  
**so that** I can understand how services interact and identify dependency issues quickly.

## Acceptance Criteria

1. New tab "Dependencies" added to main dashboard navigation
2. Dependency diagram shows all 12 services with visual connections
3. Diagram displays service relationships:
   - Home Assistant ‚Üí WebSocket Ingestion ‚Üí Enrichment Pipeline ‚Üí InfluxDB
   - External services ‚Üí Enrichment Pipeline
   - Data Retention ‚Üí S3/Glacier
   - Admin API ‚Üê Health Dashboard
4. Each service node shows real-time status (color-coded)
5. Clicking a service node highlights its dependencies
6. Hover shows service details tooltip
7. Diagram is responsive and works on mobile
8. Dark/light mode support
9. Legend explains connection types and status colors

## Dev Notes

**Technical Approach:**
- Create `ServiceDependencyGraph.tsx` component
- Use CSS Grid/Flexbox for layout (no D3.js needed initially)
- Create visual flow using Tailwind CSS
- Add service status integration
- Implement click handlers to highlight paths
- Add hover tooltips for details

**Dependency Structure:**
```
Core Flow:
  Home Assistant ‚Üí WebSocket Ingestion ‚Üí Enrichment Pipeline ‚Üí InfluxDB

Data Sources (feed into Enrichment Pipeline):
  - Weather API
  - Carbon Intensity
  - Electricity Pricing
  - Air Quality
  - Calendar
  - Smart Meter

Admin & Monitoring:
  Health Dashboard ‚Üí Admin API ‚Üí InfluxDB
  Data Retention ‚Üí InfluxDB ‚Üí S3/Glacier
```

## Tasks / Subtasks

- [x] Task 1: Create ServiceDependencyGraph component (AC: 2, 3, 7, 8)
  - [x] Create `services/health-dashboard/src/components/ServiceDependencyGraph.tsx`
  - [x] Design layout structure with 5 layers
  - [x] Create service node component
  - [x] Create connection lines/arrows
  - [x] Make responsive with overflow handling
  - [x] Support dark/light mode

- [x] Task 2: Add dependency data model (AC: 3)
  - [x] Define ServiceDependency interface in types
  - [x] Define ServiceNode interface in types
  - [x] Map all service relationships
  - [x] Create dependency graph data structure
  - [x] Add dependency metadata

- [x] Task 3: Implement visual nodes (AC: 4)
  - [x] Create service nodes with icons
  - [x] Show real-time status colors
  - [x] Add service names
  - [x] Display connection indicators (arrows)

- [x] Task 4: Add interactive features (AC: 5, 6)
  - [x] Implement click handler to highlight dependencies
  - [x] Add hover tooltips with service details
  - [x] Show selected service info panel
  - [x] Add clear selection button
  - [x] Toggle selection on double-click

- [x] Task 5: Add legend (AC: 9)
  - [x] Create legend component
  - [x] Explain status colors (Running, Degraded, Error, Unknown)
  - [x] Visual indicators for each status
  - [x] Responsive legend layout

- [x] Task 6: Create Dependencies tab (AC: 1)
  - [x] Add new "üîó Dependencies" tab to Dashboard navigation
  - [x] Integrate ServiceDependencyGraph component
  - [x] Add header with description
  - [x] Position between Services and Data Sources tabs

- [x] Task 7: Write tests (AC: All)
  - [x] Unit tests for ServiceDependencyGraph (25 tests)
  - [x] Test node click interactions
  - [x] Test hover tooltips
  - [x] Test responsive layout
  - [x] Test dark/light mode
  - [x] Test selection state management

## Testing

### Unit Tests
- Component renders with all services
- Service nodes display correct status
- Click highlights dependencies
- Hover shows tooltips
- Legend displays correctly

### Integration Tests
- Status updates from services API
- Dark mode applies correctly
- Responsive layout on mobile

### Manual Tests
- Visual verification of diagram
- Click through all services
- Verify dependency paths are correct
- Test on mobile/tablet

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### File List
- `services/health-dashboard/src/components/ServiceDependencyGraph.tsx` (new)
- `services/health-dashboard/src/components/Dashboard.tsx` (modified)
- `services/health-dashboard/src/types/index.ts` (modified - added dependency types)
- `services/health-dashboard/tests/components/ServiceDependencyGraph.test.tsx` (new)
- `docs/stories/5.9.services-tab-phase3-dependencies.md` (new)

### Debug Log
- No issues encountered during implementation
- CSS-based layout works well without D3.js
- Arrow symbols (‚Üì ‚Üí) provide clear visual flow
- Hover tooltips implemented with pure CSS
- All 12 services represented accurately

### Completion Notes
- Story created: 2025-10-11
- Implementation completed: 2025-10-11
- All 7 tasks completed successfully
- Visual dependency graph with 5-layer architecture
- 25 comprehensive unit tests written
- Interactive features (click, hover) working perfectly
- Responsive design with horizontal scroll
- No external dependencies needed (pure Tailwind CSS)

### Change Log
- 2025-10-11 13:30: Story created for Phase 3 implementation
- 2025-10-11 13:45: ServiceDependencyGraph component created
- 2025-10-11 14:00: Dependency types and data structures defined
- 2025-10-11 14:15: Visual flow diagram implemented with 5 layers
- 2025-10-11 14:30: Interactive features added (click, hover)
- 2025-10-11 14:45: Dependencies tab integrated into Dashboard
- 2025-10-11 15:00: 25 unit tests written
- 2025-10-11 15:15: Story marked Ready for Review


# Story 16.3: Improve Security Documentation for Initial Setup

## Status
Draft

## Story

**As a** user deploying HA Ingestor for the first time,  
**I want** clear guidance on securing my local deployment,  
**so that** I don't accidentally run with default passwords and weak security.

## Context
Current deployment:
- Uses default passwords in `docker-compose.yml` (admin123, adminpass)
- Weak JWT secret key (`super-secret-jwt-key`)
- Auth disabled by default (`ENABLE_AUTH=false`)
- No prominent security warnings in setup documentation

While this is acceptable for a **local single-user application**, users should be aware of these defaults and know how to change them for their deployment.

**Goal:** Make security setup obvious and easy, not enterprise-grade security hardening.

## Acceptance Criteria

1. **README Security Section**
   - Add prominent "üîí Security Setup" section near the top
   - List all default credentials that should be changed
   - Provide simple instructions for changing passwords
   - Clarify this is for local network security

2. **Environment Template**
   - Update `infrastructure/env.example` with security comments
   - Mark sensitive values clearly (passwords, tokens, keys)
   - Add instructions for generating secure values
   - Include example secure values (not actual defaults)

3. **Deployment Wizard Enhancement**
   - Add password generation/prompts to deployment wizard
   - Warn user about default passwords
   - Optional: auto-generate secure random passwords
   - Display security checklist after deployment

4. **Quick Security Checklist**
   - Create simple markdown checklist document
   - List 5-7 items for securing local deployment
   - Include in docs/ directory
   - Reference from README

5. **Docker Compose Defaults**
   - Add comments in docker-compose.yml about changing defaults
   - Optionally: remove default values, require explicit .env setup
   - Document why defaults exist (ease of initial testing)

## Tasks / Subtasks

- [ ] **Task 1: Update README.md** (AC: 1)
  - [ ] Add "üîí Security Setup" section after "Quick Start"
  - [ ] List all default credentials clearly
  - [ ] Add instructions for changing passwords
  - [ ] Link to security checklist document

- [ ] **Task 2: Update environment template** (AC: 2)
  - [ ] Edit `infrastructure/env.example`
  - [ ] Add comments for each sensitive value
  - [ ] Show example secure values (not defaults)
  - [ ] Add instructions for generating JWT secret

- [ ] **Task 3: Enhance deployment wizard** (AC: 3)
  - [ ] Modify `scripts/deploy-wizard.sh`
  - [ ] Add password prompts or generation
  - [ ] Display security warnings
  - [ ] Show security checklist after deployment

- [ ] **Task 4: Create security checklist** (AC: 4)
  - [ ] Create `docs/SECURITY_CHECKLIST.md`
  - [ ] List 5-7 key security items
  - [ ] Keep it simple and practical
  - [ ] Focus on local network security

- [ ] **Task 5: Update docker-compose.yml comments** (AC: 5)
  - [ ] Add comments about changing default passwords
  - [ ] Reference .env setup
  - [ ] Optionally: remove some default values

## Dev Notes

### Files to Modify

```
ha-ingestor/
‚îú‚îÄ‚îÄ README.md                           # Add security section
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îî‚îÄ‚îÄ env.example                     # Enhanced with security comments
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ deploy-wizard.sh               # Add password prompts
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ SECURITY_CHECKLIST.md          # NEW - simple checklist
‚îî‚îÄ‚îÄ docker-compose.yml                 # Add security comments
```

### Coding Standards
- **Documentation:** Clear, simple language
- **Markdown:** Use consistent formatting
- **Scripts:** POSIX-compliant bash

### Implementation Examples

**README.md Security Section:**
```markdown
## üîí Security Setup

**IMPORTANT:** HA Ingestor includes default passwords for ease of testing. 
Change these before deploying on your network!

### Default Credentials to Change

1. **InfluxDB Admin Password** - Currently: `admin123`
2. **Admin API Password** - Currently: `adminpass`  
3. **JWT Secret Key** - Currently: `super-secret-jwt-key`
4. **InfluxDB Token** - Currently: `ha-ingestor-token`

### How to Change Passwords

1. Copy the example environment file:
   ```bash
   cp infrastructure/env.example .env
   ```

2. Edit `.env` and set secure passwords:
   ```bash
   INFLUXDB_PASSWORD=your-secure-password-here
   ADMIN_PASSWORD=your-admin-password-here
   JWT_SECRET_KEY=$(openssl rand -hex 32)
   INFLUXDB_TOKEN=$(openssl rand -hex 32)
   ```

3. Deploy with your custom passwords:
   ```bash
   docker-compose up -d
   ```

### Security Checklist

See [Security Checklist](docs/SECURITY_CHECKLIST.md) for complete setup guide.

**Note:** This is a single-user local application. These security measures 
are for basic protection on your local network, not enterprise-grade security.
```

**infrastructure/env.example:**
```bash
# ============================================================================
# SECURITY NOTICE: Change all default passwords before deployment!
# ============================================================================

# InfluxDB Configuration
# SECURITY: Change this password! Default is 'admin123'
INFLUXDB_USERNAME=admin
INFLUXDB_PASSWORD=admin123
INFLUXDB_ORG=ha-ingestor
INFLUXDB_BUCKET=home_assistant_events

# SECURITY: Generate a secure token with: openssl rand -hex 32
INFLUXDB_TOKEN=ha-ingestor-token

# Admin API Configuration
# SECURITY: Change this password! Default is 'adminpass'
ADMIN_PASSWORD=adminpass

# SECURITY: Generate a secure JWT secret with: openssl rand -hex 32
JWT_SECRET_KEY=super-secret-jwt-key

JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Home Assistant Connection
# Your Home Assistant instance URL (e.g., http://homeassistant.local:8123)
HOME_ASSISTANT_URL=

# Your Home Assistant long-lived access token
# Generate at: Profile ‚Üí Long-Lived Access Tokens ‚Üí Create Token
HOME_ASSISTANT_TOKEN=

# Weather API (Optional)
# Get free API key at: https://openweathermap.org/api
WEATHER_API_KEY=
WEATHER_DEFAULT_LOCATION=Las Vegas,NV,US

# Logging Configuration
LOG_LEVEL=INFO
```

**docs/SECURITY_CHECKLIST.md:**
```markdown
# Security Checklist for HA Ingestor

This is a simple checklist for securing your local HA Ingestor deployment.

## Before First Deployment

- [ ] **Change InfluxDB password** from `admin123` to a secure password
- [ ] **Change Admin API password** from `adminpass` to a secure password  
- [ ] **Generate secure JWT secret** using `openssl rand -hex 32`
- [ ] **Generate secure InfluxDB token** using `openssl rand -hex 32`
- [ ] **Store passwords securely** (password manager recommended)

## Network Security

- [ ] **Restrict network access** - Only allow access from trusted devices
- [ ] **Use firewall rules** - Block external access to Docker ports if needed
- [ ] **Keep on local network** - Don't expose to public internet
- [ ] **Use HTTPS** if accessing remotely (requires reverse proxy setup)

## Ongoing Maintenance

- [ ] **Update dependencies** regularly with `docker-compose pull`
- [ ] **Review logs** periodically for unusual activity
- [ ] **Backup InfluxDB data** regularly (optional but recommended)

## Optional Enhancements

- [ ] Enable authentication in Admin API (`ENABLE_AUTH=true`)
- [ ] Set up reverse proxy with HTTPS (nginx/Caddy)
- [ ] Use Docker secrets instead of environment variables
- [ ] Implement automatic backup system

## Notes

This is a **single-user local application**. These measures provide basic 
protection for your local network. For remote access or multi-user scenarios, 
consult security best practices for your specific setup.

## Need Help?

- See [README.md](../README.md) for deployment instructions
- Check [Troubleshooting Guide](TROUBLESHOOTING.md) for common issues
- Review [Docker Structure Guide](DOCKER_STRUCTURE_GUIDE.md) for architecture
```

**scripts/deploy-wizard.sh Enhancement:**
```bash
#!/bin/bash

# ... existing code ...

echo "üîí Security Setup"
echo "================="
echo ""
echo "‚ö†Ô∏è  WARNING: Default passwords detected!"
echo ""
echo "HA Ingestor includes default passwords for testing."
echo "You should change these for your deployment."
echo ""

# Prompt for password changes
read -p "Would you like to set custom passwords now? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo ""
    read -sp "Enter InfluxDB password (or press Enter to generate): " INFLUX_PASS
    echo
    if [ -z "$INFLUX_PASS" ]; then
        INFLUX_PASS=$(openssl rand -base64 16)
        echo "Generated InfluxDB password: $INFLUX_PASS"
    fi
    
    read -sp "Enter Admin API password (or press Enter to generate): " ADMIN_PASS
    echo
    if [ -z "$ADMIN_PASS" ]; then
        ADMIN_PASS=$(openssl rand -base64 16)
        echo "Generated Admin password: $ADMIN_PASS"
    fi
    
    # Generate JWT secret
    JWT_SECRET=$(openssl rand -hex 32)
    INFLUX_TOKEN=$(openssl rand -hex 32)
    
    # Write to .env file
    echo "INFLUXDB_PASSWORD=$INFLUX_PASS" >> .env
    echo "ADMIN_PASSWORD=$ADMIN_PASS" >> .env
    echo "JWT_SECRET_KEY=$JWT_SECRET" >> .env
    echo "INFLUXDB_TOKEN=$INFLUX_TOKEN" >> .env
    
    echo "‚úÖ Passwords configured and saved to .env"
else
    echo "‚ö†Ô∏è  Using default passwords. Remember to change them!"
fi

# ... continue with deployment ...

# At end of deployment
echo ""
echo "‚úÖ Deployment complete!"
echo ""
echo "üìã Security Checklist"
echo "===================="
echo "See docs/SECURITY_CHECKLIST.md for complete security setup"
echo ""
```

### Testing Standards

**Manual Testing:**
- Verify README security section is clear and prominent
- Test deployment wizard password prompts
- Check that env.example has helpful comments
- Verify security checklist is comprehensive but simple

**Documentation Review:**
- All default passwords listed
- Instructions are clear for non-technical users
- Links between documents work correctly
- Checklist items are actionable

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Created story for security documentation | BMad Master |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_


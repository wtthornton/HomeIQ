<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HA Ingestor: Database & Automation Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        nav {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        nav a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        nav a:hover {
            background: #667eea;
            color: white;
        }

        .content {
            padding: 40px;
        }

        section {
            margin-bottom: 50px;
        }

        h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin: 30px 0 15px;
        }

        h4 {
            color: #555;
            font-size: 1.2em;
            margin: 20px 0 10px;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .highlight-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .feature-card h4 {
            color: #667eea;
            margin-top: 0;
        }

        .service-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e9ecef;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }

        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        .automation-example {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .automation-example h4 {
            color: #ff8800;
            margin-top: 0;
        }

        .stats-box {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-item .number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .stat-item .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        footer {
            background: #2d2d2d;
            color: white;
            text-align: center;
            padding: 30px;
        }

        footer a {
            color: #667eea;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            nav ul {
                flex-direction: column;
                gap: 10px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè† Home Assistant Ingestor</h1>
            <p>Database Architecture & Automation Patterns Guide</p>
        </header>

        <nav>
            <ul>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#database">Database</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#automation">Automation Patterns</a></li>
                <li><a href="#examples">Examples</a></li>
                <li><a href="#getting-started">Getting Started</a></li>
            </ul>
        </nav>

        <div class="content">
            <!-- OVERVIEW SECTION -->
            <section id="overview">
                <h2>üìñ System Overview</h2>
                
                <div class="highlight-box">
                    <p><strong>The Home Assistant Ingestor</strong> is a comprehensive microservices-based data ingestion system that captures real-time events from your Home Assistant instance, enriches them with contextual weather data, and stores them in a powerful time-series database for advanced analytics and automation patterns.</p>
                </div>

                <div class="stats-box">
                    <div class="stat-item">
                        <span class="number">10,000+</span>
                        <span class="label">Events/Day</span>
                    </div>
                    <div class="stat-item">
                        <span class="number">&lt;100ms</span>
                        <span class="label">API Response</span>
                    </div>
                    <div class="stat-item">
                        <span class="number">99.9%</span>
                        <span class="label">Uptime</span>
                    </div>
                    <div class="stat-item">
                        <span class="number">7</span>
                        <span class="label">Microservices</span>
                    </div>
                </div>

                <h3>Key Benefits</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üìä Time-Series Analytics</h4>
                        <p>Store and query millions of Home Assistant events with sub-second performance using InfluxDB's optimized time-series engine.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üå§Ô∏è Weather Correlation</h4>
                        <p>Automatically enrich every event with current weather conditions to discover environmental patterns affecting your home.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîÑ Real-Time Processing</h4>
                        <p>WebSocket-based event streaming ensures zero-latency data capture with automatic reconnection and error recovery.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üéØ Advanced Automation</h4>
                        <p>Build intelligent automation patterns based on historical trends, correlations, and predictive analytics.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üìà Visual Monitoring</h4>
                        <p>Modern React-based dashboard provides real-time system health monitoring and data visualization.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîí Production Ready</h4>
                        <p>Docker-based deployment with optimized Alpine images, health checks, and enterprise-grade reliability.</p>
                    </div>
                </div>
            </section>

            <!-- DATABASE SECTION -->
            <section id="database">
                <h2>üíæ InfluxDB Time-Series Database</h2>

                <h3>Why InfluxDB?</h3>
                <p>InfluxDB is specifically designed for time-series data, making it the perfect choice for Home Assistant event storage. Unlike traditional relational databases, InfluxDB excels at:</p>
                <ul style="margin-left: 20px; margin-bottom: 20px;">
                    <li><strong>High-volume writes:</strong> Handle 10,000+ events per day with minimal resource usage</li>
                    <li><strong>Time-based queries:</strong> Lightning-fast queries across time ranges with automatic downsampling</li>
                    <li><strong>Data retention:</strong> Automatic management of historical data with configurable retention policies</li>
                    <li><strong>Compression:</strong> Efficient storage with up to 90% compression for time-series data</li>
                    <li><strong>Tagging system:</strong> Powerful filtering and grouping using indexed tags</li>
                </ul>

                <h3>Database Schema</h3>
                <div class="highlight-box">
                    <p><strong>Organization:</strong> home_assistant<br>
                    <strong>Bucket:</strong> events<br>
                    <strong>Measurement:</strong> home_assistant_events<br>
                    <strong>Retention:</strong> 1 year for raw data, up to 5 years for aggregated data</p>
                </div>

                <h4>Tags (Indexed for Fast Filtering)</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Tag</th>
                            <th>Description</th>
                            <th>Example Values</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>entity_id</code></td>
                            <td>Home Assistant entity identifier</td>
                            <td>sensor.living_room_temperature</td>
                        </tr>
                        <tr>
                            <td><code>domain</code></td>
                            <td>Entity domain/type</td>
                            <td>sensor, switch, light, binary_sensor</td>
                        </tr>
                        <tr>
                            <td><code>device_class</code></td>
                            <td>Device classification</td>
                            <td>temperature, motion, humidity, power</td>
                        </tr>
                        <tr>
                            <td><code>area</code></td>
                            <td>Room or area location</td>
                            <td>living_room, bedroom, kitchen</td>
                        </tr>
                        <tr>
                            <td><code>weather_condition</code></td>
                            <td>Current weather state</td>
                            <td>clear, cloudy, rain, snow</td>
                        </tr>
                        <tr>
                            <td><code>time_of_day</code></td>
                            <td>Time period classification</td>
                            <td>morning, afternoon, evening, night</td>
                        </tr>
                        <tr>
                            <td><code>integration</code></td>
                            <td>Home Assistant integration</td>
                            <td>zwave, mqtt, zigbee, esphome</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Fields (Measurement Values)</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>state_value</code></td>
                            <td>string</td>
                            <td>Current state value from Home Assistant</td>
                        </tr>
                        <tr>
                            <td><code>previous_state</code></td>
                            <td>string</td>
                            <td>Previous state value before change</td>
                        </tr>
                        <tr>
                            <td><code>normalized_value</code></td>
                            <td>float</td>
                            <td>Standardized numeric value for analytics</td>
                        </tr>
                        <tr>
                            <td><code>weather_temp</code></td>
                            <td>float</td>
                            <td>Current temperature in Celsius</td>
                        </tr>
                        <tr>
                            <td><code>weather_humidity</code></td>
                            <td>float</td>
                            <td>Current humidity percentage</td>
                        </tr>
                        <tr>
                            <td><code>weather_pressure</code></td>
                            <td>float</td>
                            <td>Atmospheric pressure in hPa</td>
                        </tr>
                        <tr>
                            <td><code>energy_consumption</code></td>
                            <td>float</td>
                            <td>Energy usage in kWh (if applicable)</td>
                        </tr>
                        <tr>
                            <td><code>duration_seconds</code></td>
                            <td>integer</td>
                            <td>Time spent in current state</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Data Retention Policies</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>Raw Data</h4>
                        <p><strong>Duration:</strong> 365 days (1 year)</p>
                        <p><strong>Granularity:</strong> Full event detail</p>
                        <p><strong>Use Case:</strong> Recent analysis and troubleshooting</p>
                    </div>
                    <div class="feature-card">
                        <h4>Hourly Summaries</h4>
                        <p><strong>Duration:</strong> 730 days (2 years)</p>
                        <p><strong>Granularity:</strong> Hourly aggregates</p>
                        <p><strong>Use Case:</strong> Medium-term trend analysis</p>
                    </div>
                    <div class="feature-card">
                        <h4>Daily Summaries</h4>
                        <p><strong>Duration:</strong> 1825 days (5 years)</p>
                        <p><strong>Granularity:</strong> Daily aggregates</p>
                        <p><strong>Use Case:</strong> Long-term pattern discovery</p>
                    </div>
                </div>

                <h3>Example Event Storage</h3>
                <pre><code>Measurement: home_assistant_events
Timestamp: 2025-10-10T15:30:00Z

Tags:
  entity_id: "sensor.living_room_temperature"
  domain: "sensor"
  device_class: "temperature"
  area: "living_room"
  weather_condition: "clear"
  time_of_day: "afternoon"

Fields:
  state_value: "22.5"
  normalized_value: 22.5
  weather_temp: 18.2
  weather_humidity: 65.0
  weather_pressure: 1013.25
  unit_of_measurement: "¬∞C"</code></pre>
            </section>

            <!-- SERVICES SECTION -->
            <section id="services">
                <h2>üîß System Services & Capabilities</h2>

                <h3>Microservices Architecture</h3>
                <p>The system is built using a microservices architecture with seven specialized services that work together to provide comprehensive data ingestion and monitoring capabilities:</p>

                <div class="feature-card" style="margin: 20px 0;">
                    <h4>1. WebSocket Ingestion Service</h4>
                    <span class="service-badge">Python</span>
                    <span class="service-badge">Port 8001</span>
                    <p><strong>Purpose:</strong> Real-time event capture from Home Assistant via WebSocket connection</p>
                    <p><strong>Key Features:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Persistent WebSocket connection with automatic reconnection</li>
                        <li>Event subscription management (state_changed events)</li>
                        <li>Authentication handling with long-lived access tokens</li>
                        <li>Connection health monitoring with heartbeat checks</li>
                        <li>Graceful error handling and recovery</li>
                    </ul>
                </div>

                <div class="feature-card" style="margin: 20px 0;">
                    <h4>2. Enrichment Pipeline Service</h4>
                    <span class="service-badge">Python/FastAPI</span>
                    <span class="service-badge">Port 8002</span>
                    <p><strong>Purpose:</strong> Data validation, normalization, and weather enrichment</p>
                    <p><strong>Key Features:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Event data validation and schema enforcement</li>
                        <li>Timestamp normalization to UTC</li>
                        <li>Weather data integration and correlation</li>
                        <li>Numeric value normalization for analytics</li>
                        <li>InfluxDB write operations with batching</li>
                    </ul>
                </div>

                <div class="feature-card" style="margin: 20px 0;">
                    <h4>3. Weather API Service</h4>
                    <span class="service-badge">Python/FastAPI</span>
                    <span class="service-badge">Internal</span>
                    <p><strong>Purpose:</strong> Weather data fetching with intelligent caching</p>
                    <p><strong>Key Features:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>OpenWeatherMap API integration</li>
                        <li>15-minute caching to respect rate limits</li>
                        <li>Fallback to cached data on API failures</li>
                        <li>Location-based weather fetching</li>
                        <li>Automatic data formatting and conversion</li>
                    </ul>
                </div>

                <div class="feature-card" style="margin: 20px 0;">
                    <h4>4. Data Retention Service</h4>
                    <span class="service-badge">Python/FastAPI</span>
                    <span class="service-badge">Port 8080</span>
                    <p><strong>Purpose:</strong> Data lifecycle management and cleanup operations</p>
                    <p><strong>Key Features:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Automated data retention policy enforcement</li>
                        <li>Backup and restore operations</li>
                        <li>Data archival for long-term storage</li>
                        <li>Storage optimization and cleanup</li>
                        <li>Scheduled maintenance tasks</li>
                    </ul>
                </div>

                <div class="feature-card" style="margin: 20px 0;">
                    <h4>5. Admin API Service</h4>
                    <span class="service-badge">Python/FastAPI</span>
                    <span class="service-badge">Port 8003</span>
                    <p><strong>Purpose:</strong> REST API for system administration and monitoring</p>
                    <p><strong>API Endpoints:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li><code>GET /api/v1/health</code> - System health status</li>
                        <li><code>GET /api/v1/stats</code> - Processing statistics</li>
                        <li><code>GET /api/v1/events/recent</code> - Recent events query</li>
                        <li><code>GET /api/v1/config</code> - System configuration</li>
                        <li><code>PUT /api/v1/config</code> - Update configuration</li>
                    </ul>
                </div>

                <div class="feature-card" style="margin: 20px 0;">
                    <h4>6. Health Dashboard</h4>
                    <span class="service-badge">React/TypeScript</span>
                    <span class="service-badge">Port 3000</span>
                    <p><strong>Purpose:</strong> Web-based monitoring and visualization interface</p>
                    <p><strong>Key Features:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Real-time system health monitoring</li>
                        <li>Interactive data visualization with Chart.js</li>
                        <li>Event streaming and filtering</li>
                        <li>Configuration management interface</li>
                        <li>Mobile-responsive design</li>
                        <li>Dark/light theme support</li>
                    </ul>
                </div>

                <div class="feature-card" style="margin: 20px 0;">
                    <h4>7. InfluxDB Database</h4>
                    <span class="service-badge">InfluxDB 2.7</span>
                    <span class="service-badge">Port 8086</span>
                    <p><strong>Purpose:</strong> Time-series data storage and querying</p>
                    <p><strong>Key Features:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Optimized time-series storage engine</li>
                        <li>Web-based data exploration interface</li>
                        <li>Automatic data downsampling</li>
                        <li>Built-in retention policy management</li>
                        <li>Flux query language support</li>
                    </ul>
                </div>

                <h3>Data Flow Architecture</h3>
                <div class="highlight-box">
                    <p><strong>1. Event Capture:</strong> WebSocket service maintains persistent connection to Home Assistant</p>
                    <p><strong>2. Enrichment:</strong> Events are enriched with weather data and normalized</p>
                    <p><strong>3. Storage:</strong> Enriched events are written to InfluxDB with optimized schema</p>
                    <p><strong>4. Querying:</strong> Admin API provides REST endpoints for data access</p>
                    <p><strong>5. Visualization:</strong> Dashboard displays real-time metrics and historical trends</p>
                    <p><strong>6. Retention:</strong> Automated cleanup maintains storage efficiency</p>
                </div>
            </section>

            <!-- AUTOMATION PATTERNS SECTION -->
            <section id="automation">
                <h2>üéØ Automation Patterns & Use Cases</h2>

                <p>The Home Assistant Ingestor enables powerful automation patterns by providing historical context, weather correlation, and trend analysis. Here are practical ways to leverage this data:</p>

                <h3>Pattern-Based Automation</h3>

                <div class="automation-example">
                    <h4>üå°Ô∏è Temperature-Based Climate Control</h4>
                    <p><strong>Use Case:</strong> Automatically adjust HVAC based on indoor/outdoor temperature correlation and historical patterns.</p>
                    <p><strong>Query Logic:</strong></p>
                    <pre><code>from(bucket: "events")
  |> range(start: -30d)
  |> filter(fn: (r) => r.entity_id == "sensor.living_room_temperature")
  |> filter(fn: (r) => r.weather_temp < 15)
  |> mean()</code></pre>
                    <p><strong>Automation:</strong> When outdoor temperature drops below 15¬∞C and historical data shows indoor temperature tends to drop by 2¬∞C within 2 hours, preemptively increase heating.</p>
                </div>

                <div class="automation-example">
                    <h4>üí° Occupancy-Based Lighting</h4>
                    <p><strong>Use Case:</strong> Smart lighting that learns your patterns and predicts when lights should turn on.</p>
                    <p><strong>Query Logic:</strong></p>
                    <pre><code>from(bucket: "events")
  |> range(start: -90d)
  |> filter(fn: (r) => r.entity_id == "binary_sensor.motion_living_room")
  |> filter(fn: (r) => r.time_of_day == "evening")
  |> aggregateWindow(every: 1h, fn: count)</code></pre>
                    <p><strong>Automation:</strong> Analyze motion patterns over 90 days to predict when occupants typically enter rooms during evening hours, enabling proactive lighting.</p>
                </div>

                <div class="automation-example">
                    <h4>‚ö° Energy Optimization</h4>
                    <p><strong>Use Case:</strong> Identify energy-intensive devices and optimize usage based on weather conditions.</p>
                    <p><strong>Query Logic:</strong></p>
                    <pre><code>from(bucket: "events")
  |> range(start: -30d)
  |> filter(fn: (r) => r._field == "energy_consumption")
  |> filter(fn: (r) => r.weather_condition == "clear")
  |> sum()</code></pre>
                    <p><strong>Automation:</strong> On clear sunny days, delay high-energy tasks (laundry, dishwasher) until solar panels produce peak power, reducing grid dependency.</p>
                </div>

                <div class="automation-example">
                    <h4>üå¶Ô∏è Weather-Responsive Actions</h4>
                    <p><strong>Use Case:</strong> Automatically close windows and adjust climate when weather changes are detected.</p>
                    <p><strong>Query Logic:</strong></p>
                    <pre><code>from(bucket: "events")
  |> range(start: -1h)
  |> filter(fn: (r) => r._field == "weather_humidity")
  |> filter(fn: (r) => r._value > 80)
  |> count()</code></pre>
                    <p><strong>Automation:</strong> When humidity suddenly increases above 80%, close all automated windows and increase dehumidifier setting to prevent moisture issues.</p>
                </div>

                <h3>Advanced Analytics Patterns</h3>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>Anomaly Detection</h4>
                        <p>Identify unusual patterns in sensor readings that deviate from historical norms, enabling early detection of equipment failures or security issues.</p>
                        <p><strong>Example:</strong> Alert when power consumption is 30% higher than historical average for the same time/weather conditions.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Predictive Maintenance</h4>
                        <p>Analyze device operation patterns to predict when maintenance is needed before failures occur.</p>
                        <p><strong>Example:</strong> HVAC filter replacement alerts based on runtime hours and air quality degradation trends.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Correlation Analysis</h4>
                        <p>Discover relationships between different sensors and environmental conditions.</p>
                        <p><strong>Example:</strong> Correlate indoor air quality with outdoor weather and ventilation patterns to optimize fresh air intake.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Seasonal Adaptation</h4>
                        <p>Automatically adjust automation rules based on seasonal patterns learned from historical data.</p>
                        <p><strong>Example:</strong> Adjust heating schedules based on how quickly your home loses heat in different seasons.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Behavioral Learning</h4>
                        <p>Learn household routines and adapt automations to match actual usage patterns.</p>
                        <p><strong>Example:</strong> Adjust wake-up lighting based on historical wake time patterns, accounting for weekday/weekend differences.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Cost Optimization</h4>
                        <p>Minimize utility costs by analyzing usage patterns and shifting consumption to off-peak hours.</p>
                        <p><strong>Example:</strong> Schedule EV charging and pool pumps during cheapest electricity rate periods while ensuring readiness for next use.</p>
                    </div>
                </div>

                <h3>Integration with Home Assistant Automations</h3>
                <div class="highlight-box">
                    <p><strong>RESTful Sensor:</strong> Create Home Assistant sensors that query InfluxDB for historical statistics</p>
                    <p><strong>Node-RED Integration:</strong> Use Node-RED flows to query data and trigger complex automation logic</p>
                    <p><strong>AppDaemon Scripts:</strong> Write Python scripts that analyze trends and make intelligent decisions</p>
                    <p><strong>Health Dashboard:</strong> Use the built-in Health Dashboard at localhost:3000 for real-time visualization and monitoring</p>
                </div>
            </section>

            <!-- EXAMPLES SECTION -->
            <section id="examples">
                <h2>üí° Practical Implementation Examples</h2>

                <h3>Example 1: Smart Thermostat Optimization</h3>
                <pre><code>// Query to find optimal heating schedule based on 60 days of data
from(bucket: "events")
  |> range(start: -60d)
  |> filter(fn: (r) => 
      r.entity_id == "climate.living_room" or 
      r.entity_id == "sensor.outdoor_temperature"
  )
  |> pivot(rowKey:["_time"], columnKey:["entity_id"], valueColumn:"_value")
  |> map(fn: (r) => ({
      r with 
      temp_delta: r.climate_living_room - r.sensor_outdoor_temperature
  }))
  |> aggregateWindow(every: 1h, fn: mean)
  |> yield(name: "heating_efficiency")</code></pre>
                <p><strong>Result:</strong> Discover that your home loses 1¬∞C per hour when outdoor temperature is 10¬∞C below indoor temperature, allowing precise heating optimization.</p>

                <h3>Example 2: Motion-Based Security Pattern</h3>
                <pre><code>// Detect unusual activity patterns outside normal occupancy hours
from(bucket: "events")
  |> range(start: -90d)
  |> filter(fn: (r) => r.domain == "binary_sensor")
  |> filter(fn: (r) => r.device_class == "motion")
  |> filter(fn: (r) => r.time_of_day == "night")
  |> aggregateWindow(every: 1d, fn: count)
  |> movingAverage(n: 7)
  |> yield(name: "normal_night_motion")</code></pre>
                <p><strong>Automation:</strong> Alert when nighttime motion exceeds the 7-day moving average by 50%, indicating potential security concerns while avoiding false alarms from normal pattern variations.</p>

                <h3>Example 3: Energy Cost Optimization</h3>
                <pre><code>// Calculate daily energy consumption by device and weather condition
from(bucket: "events")
  |> range(start: -30d)
  |> filter(fn: (r) => r._field == "energy_consumption")
  |> group(columns: ["entity_id", "weather_condition"])
  |> aggregateWindow(every: 1d, fn: sum)
  |> mean()
  |> sort(desc: true)</code></pre>
                <p><strong>Result:</strong> Identify that your HVAC uses 40% more energy on humid days, suggesting dehumidifier optimization could reduce costs.</p>

                <h3>Example 4: Predictive Window Control</h3>
                <pre><code>// Predict when to close windows based on humidity trends
from(bucket: "events")
  |> range(start: -7d)
  |> filter(fn: (r) => r._field == "weather_humidity")
  |> derivative(unit: 1h, nonNegative: false)
  |> map(fn: (r) => ({
      r with
      humidity_rate: r._value
  }))
  |> filter(fn: (r) => r.humidity_rate > 10.0)</code></pre>
                <p><strong>Automation:</strong> When outdoor humidity increases more than 10% per hour, automatically close windows and activate dehumidifiers before indoor humidity becomes uncomfortable.</p>
            </section>

            <!-- GETTING STARTED SECTION -->
            <section id="getting-started">
                <h2>üöÄ Getting Started</h2>

                <h3>Prerequisites</h3>
                <ul style="margin-left: 20px; margin-bottom: 20px;">
                    <li>Docker and Docker Compose installed</li>
                    <li>Home Assistant instance with long-lived access token</li>
                    <li>OpenWeatherMap API key (free tier available)</li>
                    <li>Basic knowledge of Home Assistant and YAML</li>
                </ul>

                <h3>Quick Setup</h3>
                <div class="feature-card">
                    <h4>Step 1: Clone Repository</h4>
                    <pre><code>git clone &lt;repository-url&gt;
cd homeiq</code></pre>
                </div>

                <div class="feature-card">
                    <h4>Step 2: Configure Environment</h4>
                    <pre><code># Linux/Mac
./scripts/setup-secure-env.sh

# Windows
.\scripts\setup-secure-env.ps1</code></pre>
                    <p>The interactive setup will guide you through configuring:</p>
                    <ul style="margin-left: 20px;">
                        <li>Home Assistant URL and access token</li>
                        <li>OpenWeatherMap API key and location</li>
                        <li>InfluxDB credentials (auto-generated secure passwords)</li>
                        <li>Data retention policies</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4>Step 3: Start Services</h4>
                    <pre><code># Development environment
./scripts/start-dev.sh

# Production environment
./scripts/start-prod.sh</code></pre>
                </div>

                <div class="feature-card">
                    <h4>Step 4: Verify Installation</h4>
                    <pre><code># Test all services
./scripts/test-services.sh

# View service logs
./scripts/view-logs.sh</code></pre>
                </div>

                <h3>Access Your System</h3>
                <div class="stats-box">
                    <div class="stat-item">
                        <span class="label">Health Dashboard</span>
                        <code style="background: rgba(255,255,255,0.2); padding: 5px; border-radius: 4px;">http://localhost:3000</code>
                    </div>
                    <div class="stat-item">
                        <span class="label">InfluxDB UI</span>
                        <code style="background: rgba(255,255,255,0.2); padding: 5px; border-radius: 4px;">http://localhost:8086</code>
                    </div>
                    <div class="stat-item">
                        <span class="label">Admin API</span>
                        <code style="background: rgba(255,255,255,0.2); padding: 5px; border-radius: 4px;">http://localhost:8003</code>
                    </div>
                </div>

                <h3>Next Steps</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üìä Explore Your Data</h4>
                        <p>Open the InfluxDB UI and explore the Data Explorer to see your Home Assistant events in real-time.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üìà Create Dashboards</h4>
                        <p>Use the Health Dashboard to monitor system health and visualize event patterns.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîç Write Queries</h4>
                        <p>Learn Flux query language to extract insights from your time-series data.</p>
                    </div>
                    <div class="feature-card">
                        <h4>ü§ñ Build Automations</h4>
                        <p>Use the patterns and examples above to create intelligent automations in Home Assistant.</p>
                    </div>
                </div>

                <h3>Additional Resources</h3>
                <ul style="margin-left: 20px;">
                    <li><strong>Documentation:</strong> <code>docs/</code> directory contains comprehensive guides</li>
                    <li><strong>API Reference:</strong> <code>docs/API_DOCUMENTATION.md</code></li>
                    <li><strong>Architecture:</strong> <code>docs/architecture/</code></li>
                    <li><strong>Troubleshooting:</strong> <code>docs/TROUBLESHOOTING_GUIDE.md</code></li>
                    <li><strong>Security:</strong> <code>docs/SECURITY_CONFIGURATION.md</code></li>
                </ul>
            </section>
        </div>

        <footer>
            <p><strong>Home Assistant Ingestor</strong> - Built with ‚ù§Ô∏è for the smart home community</p>
            <p>Version 4.0 | Production Ready | <a href="https://github.com/yourusername/homeiq">GitHub Repository</a></p>
            <p style="margin-top: 10px; font-size: 0.9em;">MIT License | ¬© 2025 Home Assistant Ingestor Contributors</p>
        </footer>
    </div>
</body>
</html>

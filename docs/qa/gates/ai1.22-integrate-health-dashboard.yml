schema: 1
story: "AI1.22"
story_title: "Integrate with Health Dashboard"
gate: "NOT_STARTED"
status_reason: "Story ready for development. QA gate defines acceptance criteria and validation requirements for unified dashboard integration."
reviewer: "QA Agent"
updated: "2025-10-16T00:00:00Z"

waiver: { active: false }

top_issues: []

risk_summary:
  totals: { critical: 0, high: 0, medium: 0, low: 0 }
  recommendations:
    must_fix: []
    monitor:
      - "Component reusability from existing dashboard"
      - "Mobile responsiveness and touch targets"
      - "Performance impact of new tab on dashboard"
      - "Dark mode styling consistency"

quality_score: 0  # Will be updated after implementation
expires: "2025-12-31T00:00:00Z"

evidence:
  tests_reviewed: 0
  risks_identified: 0
  trace:
    ac_covered: []
    ac_gaps: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  # All ACs pending implementation

acceptance_criteria:
  - id: 1
    description: "New 'AI Automations' tab added to health-dashboard (13th tab)"
    validation_method: "Visual inspection and component test"
    test_cases:
      - "Test tab appears in tab list"
      - "Test tab icon and label correct (ðŸ¤– AI Automations)"
      - "Test tab navigation works"
    
  - id: 2
    description: "Tab displays pending suggestions with approve/reject workflow"
    validation_method: "Integration test with mock API"
    test_cases:
      - "Test suggestions grid displays"
      - "Test suggestion cards clickable"
      - "Test approve button functional"
      - "Test reject button functional"
    
  - id: 3
    description: "Safety validation results shown before approval"
    validation_method: "UI test with mock safety report"
    test_cases:
      - "Test safety score displayed"
      - "Test safety issues listed"
      - "Test warnings shown with severity colors"
      - "Test suggested fixes displayed"
    
  - id: 4
    description: "Audit history viewable for deployed automations"
    validation_method: "UI test with audit history component"
    test_cases:
      - "Test audit history tab/view exists"
      - "Test chronological display (newest first)"
      - "Test filtering by action type"
      - "Test timeline visualization"
    
  - id: 5
    description: "Natural language request input integrated"
    validation_method: "UI and integration test"
    test_cases:
      - "Test NL input form exists in Create view"
      - "Test textarea accepts input"
      - "Test submission triggers generation"
      - "Test success/error feedback displayed"
    
  - id: 6
    description: "Rollback functionality accessible from UI"
    validation_method: "UI interaction test"
    test_cases:
      - "Test rollback button visible on deployed automations"
      - "Test rollback requires reason input"
      - "Test confirmation flow"
      - "Test success feedback"
    
  - id: 7
    description: "Matches existing dashboard design (TailwindCSS, dark mode support)"
    validation_method: "Visual regression test"
    test_cases:
      - "Test uses TailwindCSS classes consistently"
      - "Test dark mode toggle affects all elements"
      - "Test colors match existing palette"
      - "Test typography consistent"
    
  - id: 8
    description: "Mobile responsive (works on phones and tablets)"
    validation_method: "Responsive design test"
    test_cases:
      - "Test grid collapses to single column on mobile"
      - "Test buttons have 44px minimum touch target"
      - "Test modals don't overflow viewport"
      - "Test tested on iOS and Android simulators"
    
  - id: 9
    description: "Loading states and error handling consistent with other tabs"
    validation_method: "State management test"
    test_cases:
      - "Test skeleton loaders during data fetch"
      - "Test error messages match existing style"
      - "Test retry buttons functional"
      - "Test empty states displayed appropriately"
    
  - id: 10
    description: "Real-time updates via WebSocket (optional Phase 2)"
    validation_method: "WebSocket integration test"
    test_cases:
      - "Note: Phase 2 feature - mark as DEFERRED"
      - "Test polling fallback works for Phase 1"

nfr_validation:
  security:
    status: PENDING
    criteria:
      - "No sensitive data exposed in client-side code"
      - "API calls use proper authentication"
      - "XSS prevention in user input fields"
    validation:
      - "Code review for security vulnerabilities"
      - "Test input sanitization in NL request field"
      - "Verify API tokens not exposed in browser"
  
  performance:
    status: PENDING
    criteria:
      - "Tab loads in <2 seconds"
      - "Suggestion cards render without lag"
      - "No performance regression in existing tabs"
    validation:
      - "Lighthouse performance audit"
      - "Test with 50+ suggestions (should paginate)"
      - "Verify other tabs still load quickly"
  
  usability:
    status: PENDING
    criteria:
      - "Intuitive navigation between views (Suggestions/Create/History)"
      - "Clear visual feedback for all actions"
      - "Mobile-friendly touch interactions"
    validation:
      - "User testing with 3-5 users"
      - "Accessibility audit (WCAG 2.1 AA)"
      - "Mobile usability test on real devices"
  
  maintainability:
    status: PENDING
    criteria:
      - "Reuses existing dashboard components"
      - "Follows established code patterns"
      - "Component structure clear and modular"
    validation:
      - "Code review for reusability"
      - "Test component tree depth reasonable"
      - "Verify consistent prop patterns"

integration_verification:
  - id: IV1
    description: "New tab appears in dashboard"
    test_procedure:
      - "Open health-dashboard"
      - "Locate AI Automations tab"
      - "Click tab"
    expected_result: "Tab loads without errors, displays AI automation content"
  
  - id: IV2
    description: "Suggestions display correctly"
    test_procedure:
      - "Navigate to Suggestions view"
      - "Verify card grid layout"
      - "Check status badges, confidence scores"
    expected_result: "Cards match design, information clear"
  
  - id: IV3
    description: "Approve/reject workflow functional"
    test_procedure:
      - "Click suggestion card"
      - "Modal opens with details"
      - "Click Approve button"
      - "Verify safety validation runs"
      - "Verify deployment status updates"
    expected_result: "Complete approval flow works end-to-end"
  
  - id: IV4
    description: "Natural language generation works"
    test_procedure:
      - "Navigate to Create view"
      - "Enter request"
      - "Click Generate"
      - "Verify automation appears in Suggestions"
    expected_result: "Generated automation visible and approvable"
  
  - id: IV5
    description: "Rollback accessible"
    test_procedure:
      - "Navigate to deployed automation"
      - "Click rollback button"
      - "Enter reason"
      - "Confirm rollback"
    expected_result: "Previous version restored, audit updated"

recommendations:
  immediate:
    - action: "Add AI Automations tab to Dashboard.tsx"
      refs: ["services/health-dashboard/src/components/Dashboard.tsx"]
    - action: "Create AIAutomationsTab component with 3 views"
      refs: ["services/health-dashboard/src/components/tabs/AIAutomationsTab.tsx"]
    - action: "Implement SuggestionsList component"
      refs: ["services/health-dashboard/src/components/ai-automations/SuggestionsList.tsx"]
    - action: "Implement NLRequestInput component"
      refs: ["services/health-dashboard/src/components/ai-automations/NLRequestInput.tsx"]
    - action: "Implement SuggestionDetailModal with safety and rollback"
      refs: ["services/health-dashboard/src/components/ai-automations/SuggestionDetailModal.tsx"]
    - action: "Update API service with new endpoints"
      refs: ["services/health-dashboard/src/services/api.ts"]
    - action: "Ensure dark mode styling complete"
      refs: ["All new components"]
  
  future:
    - action: "Add WebSocket real-time updates (Phase 2)"
      refs: ["services/health-dashboard/src/hooks/useRealtimeUpdates.ts"]
    - action: "Add bulk approve/reject functionality"
      refs: ["future-enhancement"]
    - action: "Add automation templates library"
      refs: ["Phase 2"]

test_plan:
  component_tests:
    - file: "tests/components/AIAutomationsTab.test.tsx"
      coverage_target: 80
      test_count_estimate: 10
      focus_areas:
        - "View switching (Suggestions/Create/History)"
        - "Component rendering"
        - "Props handling"
  
  integration_tests:
    - file: "tests/e2e/ai-automations.spec.ts"
      coverage_target: 85
      test_count_estimate: 12
      focus_areas:
        - "Complete approval workflow"
        - "NL generation flow"
        - "Rollback flow"
        - "Navigation and state management"
  
  visual_regression_tests:
    - description: "Screenshot comparison"
      test_cases:
        - "Suggestions grid light/dark mode"
        - "Modal appearance light/dark mode"
        - "Mobile layout"
        - "Empty states"
  
  accessibility_tests:
    - description: "WCAG 2.1 AA compliance"
      test_cases:
        - "Keyboard navigation works"
        - "Screen reader friendly"
        - "Color contrast sufficient"
        - "Focus indicators visible"

ui_ux_checklist:
  visual_design:
    - item: "Matches health-dashboard color palette"
      validation: "Visual inspection"
    - item: "Icons consistent with existing tabs"
      validation: "Icon audit"
    - item: "Typography matches (font, sizes, weights)"
      validation: "CSS review"
    - item: "Spacing/padding consistent"
      validation: "Tailwind class review"
  
  interaction_design:
    - item: "Loading states use skeleton cards"
      validation: "Test with slow network"
    - item: "Error messages clear and actionable"
      validation: "Error scenario testing"
    - item: "Success feedback immediate and clear"
      validation: "Positive flow testing"
    - item: "Modal transitions smooth"
      validation: "Animation review"
  
  responsive_design:
    - item: "Grid collapses appropriately on mobile"
      validation: "Test at 375px, 768px, 1024px"
    - item: "Touch targets â‰¥44px"
      validation: "Mobile device testing"
    - item: "Text readable without zooming"
      validation: "Font size check on mobile"
    - item: "Horizontal scrolling avoided"
      validation: "Viewport width testing"

browser_compatibility:
  - browser: "Chrome 120+"
    status: "PENDING"
    test_areas: ["Full functionality", "Dark mode", "Responsive"]
  
  - browser: "Firefox 120+"
    status: "PENDING"
    test_areas: ["Full functionality", "Dark mode", "Responsive"]
  
  - browser: "Safari 17+"
    status: "PENDING"
    test_areas: ["Full functionality", "Dark mode", "Responsive"]
  
  - browser: "Mobile Safari iOS 16+"
    status: "PENDING"
    test_areas: ["Touch interactions", "Responsive layout"]
  
  - browser: "Chrome Android"
    status: "PENDING"
    test_areas: ["Touch interactions", "Responsive layout"]

performance_metrics:
  - metric: "Initial Tab Load Time"
    target: "<2 seconds"
    measurement: "Lighthouse performance audit"
  
  - metric: "Time to Interactive"
    target: "<3 seconds"
    measurement: "Lighthouse TTI metric"
  
  - metric: "Bundle Size Increase"
    target: "<100KB"
    measurement: "Webpack bundle analysis"
  
  - metric: "Render FPS"
    target: "60 FPS"
    measurement: "Chrome DevTools performance profiling"

component_reusability_audit:
  reused_components:
    - "Card components (from Services/Devices tabs)"
    - "Modal pattern (from ServiceDetailsModal)"
    - "Button styles (from existing components)"
    - "Input fields (from Configuration tab)"
    - "Loading skeletons (from existing patterns)"
  
  new_components:
    - "AIAutomationsTab (main tab component)"
    - "SuggestionsList (suggestions display)"
    - "SuggestionCard (individual card)"
    - "SuggestionDetailModal (detail view)"
    - "NLRequestInput (NL generation form)"
    - "AuditHistory (audit log viewer)"
    - "SafetyReport (safety validation display)"
    - "YAMLViewer (syntax-highlighted YAML)"

notes:
  - "Integration into existing dashboard is KEY - should feel native"
  - "Reuse existing components where possible (reduces maintenance)"
  - "Dark mode support CRITICAL - test thoroughly"
  - "Mobile experience important - many users on phones"
  - "Performance regression testing - ensure other tabs unaffected"
  - "Accessibility compliance - use semantic HTML and ARIA labels"
  - "Error states and loading states must match existing patterns"
  - "Consider adding keyboard shortcuts for power users (Phase 2)"
  - "WebSocket real-time updates deferred to Phase 2 (use polling for MVP)"


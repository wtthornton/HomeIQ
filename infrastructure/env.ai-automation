# AI Automation Service Configuration (local sample)
# Copy sensitive values from your Home Assistant deployment before using in production.

# ============================================================================
# HOME ASSISTANT MQTT BROKER
# ============================================================================
# MQTT_USERNAME and MQTT_PASSWORD are loaded from .env file
# If not in .env, set defaults here:
MQTT_BROKER=homeassistant.local
MQTT_PORT=1883

# ============================================================================
# HOME ASSISTANT API
# ============================================================================
# HA_URL and HA_TOKEN are loaded from .env file
# Use HOME_ASSISTANT_URL and HOME_ASSISTANT_TOKEN in .env
# For Nabu Casa cloud fallback, use NABU_CASA_URL and NABU_CASA_TOKEN
# Otherwise set defaults here:
# HA_URL=http://homeassistant:8123
# HA_TOKEN=replace-with-long-lived-token

# ============================================================================
# DATA API
# ============================================================================
DATA_API_URL=http://data-api:8006

# ============================================================================
# OPENAI API
# ============================================================================
# OPENAI_API_KEY is loaded from .env file via docker-compose.yml environment mapping
# 
# IMPORTANT: The OpenAI API key MUST be in the .env file (not here) to prevent loss.
# docker-compose.yml maps it: OPENAI_API_KEY=${OPENAI_API_KEY:-}
# 
# To add/update: Edit .env file and add: OPENAI_API_KEY=sk-your-key-here
# Then restart: docker compose restart ai-automation-service

# ============================================================================
# SCHEDULING
# ============================================================================
ANALYSIS_SCHEDULE=0 3 * * *

# ============================================================================
# DATABASE
# ============================================================================
DATABASE_PATH=/app/data/ai_automation.db

# ============================================================================
# LOGGING
# ============================================================================
LOG_LEVEL=INFO

# ============================================================================
# AUTHENTICATION (API key protection for every endpoint)
# ============================================================================
ENABLE_AUTHENTICATION=true
AI_AUTOMATION_API_KEY=hs_P3rU9kQ2xZp6vL1fYc7bN4sTqD8mA0wR
AI_AUTOMATION_ADMIN_API_KEY=hs_P3rU9kQ2xZp6vL1fYc7bN4sTqD8mA0wR

# ============================================================================
# AI CORE SERVICE SECURITY
# ============================================================================
AI_CORE_API_KEY=${AI_CORE_API_KEY:-}  # MUST be set in .env or secrets
AI_CORE_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001
AI_CORE_RATE_LIMIT=60
AI_CORE_RATE_LIMIT_WINDOW=60

# ============================================================================
# OPENAI TOKEN OPTIMIZATION
# ============================================================================
# Disable enrichment context to reduce token usage by 2,000-5,000 tokens per request
# This prevents 429 rate limit errors when approaching the 30K TPM limit
# Enrichment context includes: weather, carbon intensity, energy pricing, air quality
# Most queries work fine without this data - re-enable selectively if needed
ENABLE_ENRICHMENT_CONTEXT=false
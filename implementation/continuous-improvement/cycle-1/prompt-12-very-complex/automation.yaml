id: 'office_wled_random_burst_15min'
alias: Office WLED random effect every 15 minutes
description: "Every 15 minutes, run a 15-second random WLED effect on Office at 100% brightness, then restore previous state."
mode: single
trigger:
  - platform: time_pattern
    minutes: '/15'
conditions: []
action:
  - service: scene.create
    data:
      scene_id: office_wled_before_random_burst
      snapshot_entities:
        - light.wled
  - variables:
      effect_source: >-
        {{ state_attr('light.wled', 'effect_list')
           if state_attr('light.wled', 'effect_list') is not none
           else state_attr('light.wled', 'effect_list_summary') }}
      random_effect: >-
        {% if effect_source is string %}
        {{ effect_source.split(', ') | random }}
        {% else %}
        {{ effect_source | random }}
        {% endif %}
      random_r: "{{ range(0, 256) | random }}"
      random_g: "{{ range(0, 256) | random }}"
      random_b: "{{ range(0, 256) | random }}"
  - service: light.turn_on
    target:
      entity_id: light.wled
    data:
      brightness: 255
      rgb_color:
        - "{{ random_r }}"
        - "{{ random_g }}"
        - "{{ random_b }}"
      effect: "{{ random_effect }}"
  - delay: '00:00:15'
  - service: scene.turn_on
    target:
      entity_id: scene.office_wled_before_random_burst
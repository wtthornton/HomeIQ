id: 'office_wled_follow_living_room_by_time'
alias: Office Wled â€“ Follow Living Room Brightness by Time
description: "When any living room light changes state, adjust the Office Wled brightness based on time of day."
mode: single
trigger:
  - platform: state
    entity_id: light.living_room_2
variables:
  office_brightness_pct: >-
    {% set b = state_attr('light.wled', 'brightness') %}
    {% if b is not none %}
      {{ (b | float(0) / 255 * 100) | round(0) }}
    {% else %}
      0
    {% endif %}
  living_brightness_pct: >-
    {% set b = state_attr('light.living_room_2', 'brightness') %}
    {% if b is not none %}
      {{ (b | float(0) / 255 * 100) | round(0) }}
    {% else %}
      0
    {% endif %}
  is_daytime: >-
    {{ now().hour >= 6 and now().hour < 18 }}
conditions: []
action:
  - delay: '00:00:02'
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ is_daytime }}"
          - condition: template
            value_template: "{{ office_brightness_pct < 50 }}"
        sequence:
          - condition: or
            conditions:
              - condition: state
                entity_id: light.wled
                state: 'on'
              - condition: state
                entity_id: light.wled
                state: 'off'
          - condition: template
            value_template: "{{ office_brightness_pct | int != 70 }}"
          - service: light.turn_on
            target:
              entity_id: light.wled
            data:
              brightness: "{{ (255 * 0.7) | int }}"
      - conditions:
          - condition: template
            value_template: "{{ not is_daytime }}"
          - condition: state
            entity_id: light.living_room_2
            state: 'on'
          - condition: template
            value_template: "{{ living_brightness_pct > 60 }}"
          - condition: state
            entity_id: light.wled
            state: 'on'
          - condition: template
            value_template: "{{ office_brightness_pct | int != 30 }}"
        sequence:
          - service: light.turn_on
            target:
              entity_id: light.wled
            data:
              brightness: "{{ (255 * 0.3) | int }}"
id: 'living_room_wled_day_night_adjust'
alias: Living Room - Adjust Office WLED by Time of Day
description: "When Living Room light changes, adjust Office WLED brightness by time of day with 2s debounce"
mode: restart
trigger:
  - platform: state
    entity_id: light.living_room_2
action:
  - delay: '00:00:02'
  - variables:
      office_brightness: "{{ state_attr('light.wled', 'brightness') | int(0) }}"
      office_brightness_pct: "{{ (office_brightness / 255 * 100) | round(0) if office_brightness > 0 else 0 }}"
      living_brightness: "{{ state_attr('light.living_room_2', 'brightness') | int(0) }}"
      living_brightness_pct: "{{ (living_brightness / 255 * 100) | round(0) if living_brightness > 0 else 0 }}"
      now_hour: "{{ now().hour }}"
      is_daytime: "{{ 6 <= now_hour < 18 }}"
      is_nighttime: "{{ now_hour >= 18 or now_hour < 6 }}"
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ is_daytime }}"
          - condition: template
            value_template: "{{ office_brightness_pct < 50 }}"
          - condition: template
            value_template: "{{ office_brightness_pct != 70 }}"
        sequence:
          - service: light.turn_on
            target:
              entity_id: light.wled
            data:
              brightness_pct: 70
      - conditions:
          - condition: template
            value_template: "{{ is_nighttime }}"
          - condition: template
            value_template: "{{ living_brightness_pct > 60 }}"
          - condition: template
            value_template: "{{ office_brightness_pct != 30 }}"
        sequence:
          - service: light.turn_on
            target:
              entity_id: light.wled
            data:
              brightness_pct: 30
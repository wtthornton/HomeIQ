id: 'office_wled_follow_living_room_brightness_by_time'
alias: Office WLED – Follow Living Room Brightness by Time
description: "Adjust Office WLED brightness by time of day when living room lights change"
mode: restart
trigger:
  - platform: state
    entity_id:
      - light.wled
conditions: []
action:
  - choose:
      # Daytime behavior: 06:00–18:00
      - conditions:
          - condition: time
            after: '06:00:00'
            before: '18:00:00'
          - condition: template
            value_template: "{{ not is_state('light.wled', 'unavailable') }}"
          - condition: template
            value_template: >-
              {% set bri = state_attr('light.wled', 'brightness') | int(0) %}
              {{ bri == 0 or (bri > 0 and (bri / 255) < 0.5) }}
        sequence:
          - delay: '00:00:02'
          - condition: template
            value_template: >-
              {% set bri = state_attr('light.wled', 'brightness') | int(0) %}
              {% set perc = (bri / 255 * 100) | round(0) if bri > 0 else 0 %}
              {{ perc != 70 }}
          - service: light.turn_on
            target:
              entity_id: light.wled
            data:
              brightness: 178
      # Nighttime behavior: 18:00–06:00
      - conditions:
          - condition: or
            conditions:
              - condition: time
                after: '18:00:00'
              - condition: time
                before: '06:00:00'
          - condition: template
            value_template: "{{ not is_state('light.wled', 'unavailable') }}"
          - condition: template
            value_template: >-
              {% set bri = state_attr('light.wled', 'brightness') | int(0) %}
              {{ bri > 0 and (bri / 255) > 0.3 }}
        sequence:
          - delay: '00:00:02'
          - condition: template
            value_template: >-
              {% set bri = state_attr('light.wled', 'brightness') | int(0) %}
              {% set perc = (bri / 255 * 100) | round(0) if bri > 0 else 0 %}
              {{ perc != 30 }}
          - service: light.turn_on
            target:
              entity_id: light.wled
            data:
              brightness: 77
    default: []
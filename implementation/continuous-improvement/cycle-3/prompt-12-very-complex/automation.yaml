id: 'office_wled_random_effect_15min'
alias: Office WLED â€“ Random 15s effect every 15min (with full restore)
description: "Every 15 minutes, play a random WLED effect for 15 seconds at 100% brightness, then restore the previous state."
mode: single
trigger:
  - platform: time_pattern
    minutes: "/15"
conditions:
  - condition: not
    conditions:
      - condition: state
        entity_id: light.wled
        state: "unavailable"
action:
  - variables:
      wled_effect_list: "{{ state_attr('light.wled', 'effect_list') or [] }}"
      wled_random_effect: >-
        {% if wled_effect_list | count > 0 %}
          {{ (wled_effect_list | list | random) }}
        {% else %}
          Solid
        {% endif %}
      wled_random_color: >-
        {{ [
          range(0,255)|random,
          range(0,255)|random,
          range(0,255)|random
        ] }}
  - service: scene.create
    data:
      scene_id: office_wled_before_random_show
      snapshot_entities:
        - light.wled
  - choose:
      - conditions:
          - condition: state
            entity_id: light.wled
            state: "on"
        sequence:
          - service: light.turn_on
            target:
              entity_id: light.wled
            data:
              brightness: 255
              rgb_color: "{{ wled_random_color }}"
              effect: "{{ wled_random_effect }}"
          - delay: "00:00:15"
          - service: scene.turn_on
            target:
              entity_id: scene.office_wled_before_random_show
    default:
      - delay: "00:00:01"
      - service: scene.turn_on
        target:
          entity_id: scene.office_wled_before_random_show
{
  "prompt_id": "prompt-12-very-complex",
  "prompt_name": "State Restoration with Conditions",
  "prompt_text": "Every 15 mins choose a random effect on the Office WLED device. Play the effect for 15 secs. Choose random effect, random colors and brightness to 100%. At the end of the 15 sec the WLED light needs to return to exactly what it was before it started.",
  "complexity": "Very Complex",
  "query_id": "query-641b3168",
  "suggestion_id": "ask-ai-841280a7",
  "automation_id": "automation.office_wled_random_effect_15min_1763979835_701e9d15",
  "automation_yaml": "id: 'office_wled_random_effect_15min'\nalias: Office WLED \u2013 Random 15s effect every 15min (with full restore)\ndescription: \"Every 15 minutes, play a random WLED effect for 15 seconds at 100% brightness, then restore the previous state.\"\nmode: single\ntrigger:\n  - platform: time_pattern\n    minutes: \"/15\"\nconditions:\n  - condition: not\n    conditions:\n      - condition: state\n        entity_id: light.wled\n        state: \"unavailable\"\naction:\n  - variables:\n      wled_effect_list: \"{{ state_attr('light.wled', 'effect_list') or [] }}\"\n      wled_random_effect: >-\n        {% if wled_effect_list | count > 0 %}\n          {{ (wled_effect_list | list | random) }}\n        {% else %}\n          Solid\n        {% endif %}\n      wled_random_color: >-\n        {{ [\n          range(0,255)|random,\n          range(0,255)|random,\n          range(0,255)|random\n        ] }}\n  - service: scene.create\n    data:\n      scene_id: office_wled_before_random_show\n      snapshot_entities:\n        - light.wled\n  - choose:\n      - conditions:\n          - condition: state\n            entity_id: light.wled\n            state: \"on\"\n        sequence:\n          - service: light.turn_on\n            target:\n              entity_id: light.wled\n            data:\n              brightness: 255\n              rgb_color: \"{{ wled_random_color }}\"\n              effect: \"{{ wled_random_effect }}\"\n          - delay: \"00:00:15\"\n          - service: scene.turn_on\n            target:\n              entity_id: scene.office_wled_before_random_show\n    default:\n      - delay: \"00:00:01\"\n      - service: scene.turn_on\n        target:\n          entity_id: scene.office_wled_before_random_show",
  "clarification_rounds": 1,
  "clarification_log": [
    {
      "round": 1,
      "questions": [
        {
          "id": "q1",
          "category": "device",
          "question_text": "Which device did you mean? Device 'light' matches devices in wrong location. You mentioned: end of, office",
          "question_type": "text",
          "options": null,
          "priority": 1,
          "related_entities": [
            "c0070ae3ca3271e5c18c37fc1beaf0e8"
          ],
          "cached_answer": null,
          "cached_entities": null,
          "cached_similarity": null
        },
        {
          "id": "q2",
          "category": "action",
          "question_text": "Could you clarify: Action 'turn' is vague - missing details: dim, brighten",
          "question_type": "text",
          "options": null,
          "priority": 2,
          "related_entities": null,
          "cached_answer": null,
          "cached_entities": null,
          "cached_similarity": null
        }
      ],
      "answers": [
        {
          "question_id": "q1",
          "answer_text": "Office Wled",
          "selected_entities": null
        },
        {
          "question_id": "q2",
          "answer_text": "Yes",
          "selected_entities": null
        }
      ],
      "timestamp": "2025-11-24T02:23:19.965228"
    }
  ],
  "automation_score": 85.0,
  "yaml_score": 100.0,
  "total_score": 91.5,
  "error": null,
  "success": true,
  "timestamp": "2025-11-24T02:23:18.399475"
}